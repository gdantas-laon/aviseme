<?xml version="1.0" encoding="utf-8"?>
<modification>
    <code>aviseme</code>
    <name>Avise-me</name>
    <version>1.0</version>
    <author>Gabriel Dantas</author>
    <link>https://github.com/gdantas-laon/aviseme</link>
    <file path="admin/language/pt-br/common/column_left.php">
        <operation>
            <search><![CDATA[$_['text_other_status']         = 'Outras situações';]]></search>
            <add position="before">
                <![CDATA[
    			$_['text_aviseme']         = 'Avise-me';
    			]]>
            </add>
        </operation>
    </file>
    <file path="admin/controller/common/column_left.php">
        <operation>
            <search><![CDATA[$catalog = array();]]></search>
            <add position="after">
                <![CDATA[
    			$data['menus'][] = array(
					'id'       => 'aviseme',
					'icon'	   => 'fa-envelope-o',
					'name'	   => $this->language->get('text_aviseme'),
					'href'     => $this->url->link('extension/module/aviseme', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()
				);
    			]]>
            </add>
        </operation>
    </file>
    <file path="catalog/controller/product/product.php">
        <operation>
            <search><![CDATA[
			$this->model_catalog_product->updateViewed($this->request->get['product_id']);
			]]></search>
            <add position="after">
                <![CDATA[
                 $data['aviseme'] = $this->load->controller('extension/module/aviseme');
    			]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[
			$data['description'] = html_entity_decode($product_info['description'], ENT_QUOTES, 'UTF-8');
			]]></search>
            <add position="after">
                <![CDATA[
                 $data['quantity'] = $product_info['quantity'];
    			]]>
            </add>
        </operation>
    </file>
    <file path="catalog/language/pt-br/product/product.php">
        <operation>
            <search><![CDATA[
			$_['text_instock']             = 'Em estoque';
			]]></search>
            <add position="after">
                <![CDATA[
                $_['text_aviseme']         = 'Avise-me quando chegar';
                $_['text_loggedCustomer']   = 'Você será informado quando chegar';
                $_['text_blank_email']         = 'O email não pode ficar em branco';
    			$_['text_invalid_email']         = 'Email invalido';
    			$_['text_success_email']         = 'Você será informado quando esse item entrar em estoque!';
    			$_['text_undefined_error']       = 'Ops, houve um erro ao fazer sua requisição';
    			]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[
			$data['description'] = html_entity_decode($product_info['description'], ENT_QUOTES, 'UTF-8');
			]]></search>
            <add position="after">
                <![CDATA[
                 $data['quantity'] = $product_info['quantity'];
    			]]>
            </add>
        </operation>
    </file>
    <file path="admin/language/pt-br/catalog/product.php">
    <operation>
        <search><![CDATA[
		$_['text_keyword']           = 'Não utilize espaços, substitua os espaços por - (hífen), e certifique-se que a palavra é exclusiva em toda a loja.';
			]]></search>
        <add position="after">
            <![CDATA[
                $_['text_email_body']         = 'Lembramos de você: O produto que você queria voltou ao estoque -';
                $_['text_subject']            = '- Chegou! - ';
                $_['text_go_product']         = 'Mas corra antes que acabe novamente' ;
                ]]>
        </add>
    </operation>
    </file>
    <file path="catalog/view/theme/*/template/product/product.twig">
        <operation>
            <search><![CDATA[<a id="button-cart"]]></search>
            <add position="before"><![CDATA[
                {%if quantity > 0%}
                ]]>
            </add>
        </operation>
        <operation>
            <search><![CDATA[{{ button_cart }}</span></a>]]></search>
            <add position="after"><![CDATA[
                {%else%}
                {{ aviseme }}
                {%endif%}
                ]]>
            </add>
        </operation>
    </file>
    <file path="admin/controller/catalog/product.php">
    <operation error="skip" info="Adds a call to notify the customer if the item is available for purchase; upon the item being added back in stock.">
        <search ><![CDATA[
          $this->model_catalog_product->editProduct($this->request->get['product_id'], $this->request->post);
          ]]></search>
        <add position="after"><![CDATA[
          $this->load->model('extension/module/aviseme');

          if (isset($this->request->post['quantity']) && $this->request->post['quantity'] >0 ) {
            $product_request = $this->model_extension_module_aviseme->getRequest($this->request->get['product_id']);
              if ($product_request >0){
                $this->model_extension_module_aviseme->sendNotifications($this->request->get['product_id']);
              }
          }
        ]]></add>
    </operation>
    </file>
</modification>